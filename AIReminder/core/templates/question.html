{% load static %}
<head>
    <link rel="stylesheet" href="{% static 'css/question.css' %}">
</head>
<body>
    <div class="question-page">
        <div class="question-content">
            <div class="question-header">
                <h2>テーマ: {{ theme }}</h2>
                <p class="question-counter">問題 {{ question_number }}/{{ total_questions }}</p>
            </div>
            
            <div class="question-text">
                {{ question|linebreaks }}
            </div>

            <form id="answer-form" action="{% url 'answer_question' question_number %}" method="POST">
                {% csrf_token %}
                {% for option in options %}
                <div class="option-item">
                    <input type="radio" 
                           id="option{{ option.letter }}" 
                           name="answer" 
                           value="{{ option.letter }}"
                           class="option-radio"
                           required>
                    <label for="option{{ option.letter }}" class="option-label">
                        ({{ option.letter }}) {{ option.text }}
                    </label>
                </div>
                {% endfor %}
                <button type="submit" class="submit-button">回答する</button>
            </form>
        </div>
    </div>

    <script>
        const submitButton = document.getElementById('submit-answer');
        const resultContainer = document.getElementById('result-container');
        const correctOption = '{{ correct_option|escapejs }}';

        submitButton.addEventListener('click', async () => {
            const selectedOptions = Array.from(document.querySelectorAll('input[name="options"]:checked'))
                .map(checkbox => checkbox.value);

            const formData = new FormData();
            formData.append('answer', selectedOptions.join(', '));
            formData.append('correct_option', correctOption);

            const response = await fetch('/answer_question/', {
                method: 'POST',
                body: formData,
            });
            const data = await response.json();

            resultContainer.innerText = data.explanation;
        });
    </script>
</body>